/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Tue, 02 Nov 2021 10:55:58 GMT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).guide=e()}(this,(function(){"use strict";var t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",autoPosition:!1,disableInteraction:!1,animation:!1,exitOnEsc:!1},e={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",width:"",height:"",offsetTop:"20",offsetLeft:"0"};const s=t=>Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(t=>t.toLowerCase())),i=(t,e)=>{if(!e)return;let s="";return t.style.cssText&&(s+=t.style.cssText),"string"==typeof e?s+=e:Object.keys(e).forEach((t=>{s+=`${t}:${e[t]};`})),t.style.cssText=s,t},n=(t,e)=>{let s=document.createElement(t);e=e||{};for(const t in e){let n=e[t];"style"===t?i(s,n):s.setAttribute(t,n)}return s},r=function(){this.nextstep()},o=function(){this.prevstep()},h=function(){this.skipstep()},d=function(){this.donestep()},p=function(){if(!this.guide)return;const t=this.guide;l.apply(this),this.button.next?.addEventListener("click",r.bind(t)),this.button.prev?.addEventListener("click",o.bind(t)),this.button.skip?.addEventListener("click",h.bind(t)),this.button.done?.addEventListener("click",d.bind(t))},l=function(){if(!this.guide)return;const t=this.guide;this.button.next?.removeEventListener("click",r.bind(t)),this.button.prev?.removeEventListener("click",o.bind(t)),this.button.skip?.removeEventListener("click",h.bind(t)),this.button.done?.removeEventListener("click",d.bind(t))},a=function(){this.create()},u=function(){window.addEventListener("resize",a.bind(this))},c=function(){window.removeEventListener("resize",a.bind(this))},b=function(){Object.values(this).forEach((t=>{t&&t.classList.remove("hide","show")}))},v=function(){if(!this.currentStep)return;b.apply(this.currentStep.button);const t=this.steps,e=this.currentStepNumber,s=t.length,{next:i,prev:n,skip:r,done:o}=this.currentStep.button;0===e?(i?.classList.add("show"),n?.classList.add("hide"),r?.classList.add("hide"),o?.classList.add("hide")):e===s-1?(i?.classList.add("hide"),n?.classList.add("show"),r?.classList.add("hide"),o?.classList.add("show")):(i?.classList.add("show"),n?.classList.add("show"),r?.classList.add("hide"),o?.classList.add("hide"))},g=function(...t){const e=t[0].arguments[2],s=this.allSteps?this.allSteps[e]:null;this.setSteps(s).start()},y=function(){m();const t=function(t){const e=history[t],s=new Event(t);return function(){const t=e.apply(this,arguments);return s.arguments=arguments,window.dispatchEvent(s),t}};history.pushState=t("pushState"),history.replaceState=t("replaceState"),window.addEventListener("hashchange",g.bind(this)),window.addEventListener("popstate",g.bind(this)),window.addEventListener("pushState",g.bind(this)),window.addEventListener("replaceState",g.bind(this))},m=function(){window.removeEventListener("hashchange",g.bind(this)),window.removeEventListener("popstate",g.bind(this)),window.removeEventListener("pushState",g.bind(this)),window.removeEventListener("replaceState",g.bind(this))};class f{constructor(t,s){this.el=null,this.target=null,this.content=null,this.guide=s,this.button={next:".guide-next-button",prev:".guide-prev-button",skip:".guide-skip-button",done:".guide-done-button"},this.setOptions(e),this.setOptions(t)}setOption(t,e){t&&e&&(this[t]=e)}setOptions(t){t&&Object.keys(t).forEach((e=>{this.setOption(e,t[e])}))}create(){const t=this.el;this.target=document.querySelector(t),this.target||console.error(`未找到${this.el}元素`),this._createHelperLayer(),this._createToolTip()}destory(){this._removeToolTip(),this._removeHelperLayer(),l.apply(this),this._clearButtonDom()}_getDomStyle(t){this.body=document.getElementsByTagName("body")[0];const e=this.guide.currentStep,{width:s,height:i,top:n,left:r}=e.target.getBoundingClientRect(),o=Number(e.offsetTop),h=Number(e.offsetLeft),d={width:s+"px",height:i+"px",top:n+"px",left:r+"px"},p={width:e.width+"px",height:e.height+"px",top:i+n+o+"px",left:r+h+"px"};switch(t){case"helperLayerStryle":return d;case"toolTipStyle":return p}}_createHelperLayer(){const t=this._getDomStyle("helperLayerStryle");this.guide.helperLayer?i(this.guide.helperLayer,t):(this.guide.helperLayer=n("div",{style:t,class:"guide-helperLayer"}),this.body.appendChild(this.guide.helperLayer))}_removeHelperLayer(){this.guide.helperLayer?.remove(),this.guide.helperLayer=null}_createToolTip(){const t=this._getDomStyle("toolTipStyle");this.guide.toolTip?(i(this.guide.toolTip,t),this._getButtonDom()):(this.guide.toolTip=(t=>{const e=n("div",{style:t,class:"guide-tooltip"});return e.innerHTML='\n    <div class="guide-container">\n    <div class="guide-image">\n        <img src="" alt="" />\n    </div>\n    <div class="guide-message">\n        <h4>创建批注</h4>\n        <p>在设计图上 单击 或 拖拽 绘制 快捷键</p>\n    </div>\n</div>\n<div class="guide-button-box">\n    <div class="guide-button guide-next-button">继续探索</div>\n    <div class="guide-button guide-prev-button">上一步</div>\n    <div class="guide-button guide-skip-button">跳过</div>\n    <div class="guide-button guide-done-button">知道啦</div>\n</div>\n     ',e})(t),this.body.appendChild(this.guide.toolTip),this._getButtonDom(),p.apply(this))}_removeToolTip(){this.guide.toolTip?.remove(),this.guide.toolTip=null}_getButtonDom(){this._button=this.button,Object.keys(this.button).forEach((t=>{this.button[t]=document.querySelector(this.button[t])}))}_clearButtonDom(){this.button=this._button}}class L{constructor(e){this.allSteps=null,this.steps=[],this.currentStep=null,this.currentStepNumber=-1,this.overlayer=null,this.toolTip=null,this.helperLayer=null,this.setOptions(t),this.setOptions(e)}get currentStep(){return this._currentStep}set currentStep(t){t&&this.currentStep!==t&&(this._currentStep=t,this.currentStep?.create(),this._createOverlayer(),v.apply(this))}setOption(t,e){if(t&&e)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}addstep(t){return this.steps||(this.steps=[]),this.steps.push(new f(t,this)),this}addsteps(t){return"array"===s(t)?t.forEach((t=>{this.addstep(t)})):console.error("stepDatas 格式错误"),this}setSteps(t){return this.steps=null,this.addsteps(t),this}addAllSteps(t){if("object"===s(t))return this.allSteps=t,y.apply(this),this}goToStep(t){return this.currentStep!==t&&(this.currentStep=t,this.steps.indexOf(t)>-1&&this.goToStepNumber(this.steps.indexOf(t))),this}goToStepNumber(t){return this.currentStepNumber!==t&&(this.currentStepNumber=t,this.goToStep(this.steps[t])),this}nextstep(){const t=this.currentStepNumber;t<this.steps.length&&this.goToStepNumber(t+1)}prevstep(){const t=this.currentStepNumber;t>0&&this.goToStepNumber(t-1)}skipstep(){}donestep(){this.exit()}getcurrentstep(){}start(){if(this.steps&&0!==this.steps?.length)return this.goToStepNumber(0),u.apply(this.currentStep),this}exit(){this._removeOverlayer(),m(),c.apply(this.currentStep),this.currentStep?.destory()}_createOverlayer(){var t;this.overlayer||(this.overlayer=(t={opacity:this.overlayOpacity},n("div",{style:t,class:"guide-overlayer"})),this.body=document.getElementsByTagName("body")[0],this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove()}}return L.prototype.version="1.0.0",L}));
