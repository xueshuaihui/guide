/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Tue, 07 Dec 2021 02:10:29 GMT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).guide=e()}(this,(function(){"use strict";var t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",animation:!1,width:200,height:200};let e={};const i=t=>Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(t=>t.toLowerCase())),s=["width","height","left","right","top","bottom","margin","margin-top","margin-left","margin-bottom","margin-right"],n=(t,e)=>{if(!e)return;let i="";return t.style.cssText&&(i+=t.style.cssText),"string"==typeof e?i+=e:Object.keys(e).forEach((t=>{s.indexOf(t)>=0&&!isNaN(e[t])?i+=`${t}:${e[t]}px;`:i+=`${t}:${e[t]};`})),t.style.cssText=i,t},o=(t,e)=>{let i=document.createElement(t);e=e||{};for(const t in e){let s=e[t];"style"===t?n(i,s):i.setAttribute(t,s)}return i},a=(t,e)=>{window.scrollBy(t,e)},l=function(t,e){let i={style:t,class:"guide-step-target guide-overlayer-bgcolor"};const s=o("div",i);return s.innerHTML=r.call(this,e),s},r=function(t){return this.activeSteps[t],`\n\t<div class="guide-tooltip" style="">\n\t    <div class="guide-joints">\n\t    </div>\n\t    <div class="guide-tooltip-main" style="width:${this.width}px;height:${this.height}px;">\n\t        <div class="guide-container"></div>\n\t        <div class="guide-button-box">\n\t            <div class="guide-button guide-next-button ${this.nextclass}" code="next" steps="${t}">${this.nextLabel}</div>\n\t            <div class="guide-button guide-prev-button ${this.prevclass}" code="prev" steps="${t}">${this.prevLabel}</div>\n\t            <div class="guide-button guide-skip-button ${this.skipclass}" code="skip" steps="${t}">${this.skipLabel}</div>\n\t            <div class="guide-button guide-done-button ${this.doneclass}" code="done" steps="${t}">${this.doneLabel}</div>\n\t        </div>\n\t    </div>\n\t</div>\n\t`};var h={content:"",width:"",height:"",offsetX:"0",offsetY:"0",position:"bottom",tipClass:"",jointsClass:"joints-triangle",jointsX:"",jointsY:""};class p{constructor(t){this.container=null,this.setOptions(h),this.setOptions(t)}setOption(t,e){if(t)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}setContainer(t){if("hTMLDivElement"===i(t))return this.container=t.querySelector(".guide-container"),this.loadTip(),this}loadTip(){this.setElTarget(),this.container.innerHTML=function(t,e,i,s){s=s||function(t,e,i,s,n){var o=e.split("\n"),a=Math.max(s-3,0),l=Math.min(o.length,s+3),r=n(i),h=o.slice(a,l).map((function(t,e){var i=e+a+1;return(i==s?" >> ":"    ")+i+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+s+"\n"+h+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(o,a)};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function a(t){return n[t]||t}var l=1;try{var r="";function i(t){null!=t&&(r+=t)}return i('<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    '),l=22,t.image&&(i('\n        <div class="guide-image guide-image-template1">\n            <img src="'),l=24,i(e(t.image)),i('" alt="" />\n        </div>\n        '),l=26),i('\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    '),l=30,i(e(t.title)),i("\n                </h3>\n                <p>\n                    "),l=33,i(e(t.text)),i("\n                </p>\n            </div>\n</div>"),l=36,r}catch(t){s(t,'<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    <% if (locals.image) { %>\n        <div class="guide-image guide-image-template1">\n            <img src="<%= locals.image %>" alt="" />\n        </div>\n        <% } %>\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    <%= locals.title %>\n                </h3>\n                <p>\n                    <%= locals.text %>\n                </p>\n            </div>\n</div>',void 0,l,e)}}(this.content)}setElTarget(){const t=document.querySelector(this.el);if(t&&t.getClientRects().length){const{width:e,height:i,top:s,left:n}=t.getClientRects()[0];this.elTarget={width:e,height:i,top:s,left:n}}}setSize(t,e){if(Array.prototype.includes.call(t.classList,"guide-step-target")){const i=t.querySelector(".guide-tooltip-main"),s=this.width||e.width||parseInt(i.style.width),o=this.height||e.height||parseInt(i.style.height);n(i,{width:s,height:o})}}setJoints(t){if(Array.prototype.includes.call(t.classList,"guide-step-target")){const e=t.querySelector(".guide-joints");e.className="guide-joints",e.classList.add(this.jointsClass),this.jointsWidth&&n(e,{width:this.jointsWidth}),this.jointsHeight&&n(e,{height:this.jointsHeight}),n(e,{"margin-top":this.jointsY||"auto","margin-left":this.jointsX||"auto"}),console.log({"margin-top":this.jointsY,"margin-left":this.jointsX})}}setPosition(t){const e=this.position;if(Array.prototype.includes.call(t.classList,"guide-step-target")){const i=t.querySelector(".guide-tooltip");i.className="guide-tooltip",i.classList.add(`guide-tooltip-${e}`),"bottom"===e?n(i,{"margin-top":this.offsetY||"auto","margin-left":this.offsetX||"auto"}):"top"===e?n(i,{"margin-bottom":-this.offsetY||"auto","margin-left":this.offsetX||"auto","margin-top":"auto"}):"left"===e?n(i,{"margin-top":this.offsetY||"auto","margin-left":this.offsetX||"auto"}):"right"===e&&n(i,{"margin-top":this.offsetY||"auto","margin-right":-this.offsetX||"auto","margin-left":"auto"})}}}return class{constructor(e){this.version="1.0.0",this.steps=null,this.activeSteps={},this.overlayer=null,this.setOptions(t),this.setOptions(e),this.bindEvent()}setOption(t,e){if(t)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}start(t){if(this.steps&&0!==this.steps?.length)return this._createOverlayer(),this.setStepsState(t,!0),this}setStepsState(t,e){const i=this.steps[t];if(e){if(this.activeSteps[t])return;this.activeSteps[t]={stepNumber:-1,steps:i},this._createGuideStepBox(t),this.body.appendChild(this.activeSteps[t].element),this._switchStepsNumber(t),this.setStepsNumber(t,0),n(this.overlayer,{display:"block"})}else this._removeGuideStepBox(t),delete this.activeSteps[t]}_switchStepsNumber(t){var i,s;s=t=>{const e=Array.prototype.shift.call(t),{element:i,stepNumber:s,steps:n}=this.activeSteps[e],o=new p(n[s]);o.setContainer(i),this.activeSteps[e].currentStep=o,this._setTipPosition(e),o.setPosition(i),o.setSize(i,{width:this.width,height:this.height}),o.setJoints(i)},e[i=t]||(e[i]=[]),e[i].push(s)}_setTipPosition(t){const e=this.activeSteps[t],{currentStep:i,element:s}=e;n(s,{display:"block"});let o=i.elTarget;o?(s.classList.remove("guide-step-notarget"),(t=>{const e=document.querySelector(t),{width:i,height:s,top:n,left:o}=e.getClientRects()[0];(n<0||n>outerHeight-s)&&a(0,n-s)})(i.el),i.setElTarget(),o=i.elTarget):(s.classList.add("guide-step-notarget"),o={width:0,height:0,top:"50%",left:"50%"});const{width:l,height:r,top:h,left:p}=o;n(s,{width:l,height:r,top:h,left:p})}setStepsNumber(t,s){const n=this.activeSteps[t];if(!n)return;"number"===i(s)?n.stepNumber=s:"++"===s?n.stepNumber++:"--"===s&&n.stepNumber--;const o=n.steps.length;n.stepNumber>=0&&n.stepNumber<o?((...t)=>{let i=t[0];const s=e[i];if(!s||0===s.length)return!1;for(var n,o=0;n=s[o++];)n(t)})(t,n.stepNumber):this.remove(t)}remove(t){t?(this._removeGuideStepBox(t),this.setStepsState(t,!1),n(this.overlayer,{display:"none"})):console.error("缺少steps name.")}_createOverlayer(){this.overlayer||(this.overlayer=o("div",{style:{display:"none"},class:"guide-overlayer"}),this.body||(this.body=document.getElementsByTagName("body")[0]),this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove(),this.overlayer=null}_createGuideStepBox(t){if(!t)return void console.error("缺少 step name");const e=l.call(this,{display:"none"},t);this.activeSteps[t].element=e}_removeGuideStepBox(t){t?this.activeSteps[t]?.element?.remove():console.error("缺少 step name")}bindEvent(){this.body=document.getElementsByTagName("body")[0],this.body.onclick=t=>{const e=t.target;if(Array.prototype.includes.call(e.classList,"guide-button")){const t=e.getAttribute("code"),i=e.getAttribute("steps");switch(t){default:this.Next(i);break;case"prev":this.Prev(i);break;case"skip":this.Skip(i);break;case"done":this.Done(i)}}}}Next(t){t&&(this.activeSteps[t],this.setStepsNumber(t,"++"))}Prev(t){t&&this.setStepsNumber(t,"--")}Skip(t){t&&this.remove(t)}Done(t){t&&this.setStepsNumber(t,"++")}}}));
