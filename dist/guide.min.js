/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Tue, 07 Dec 2021 02:10:29 GMT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).guide=e()}(this,(function(){"use strict";var t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",animation:!1,width:200,height:200};let e={};const s=t=>Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(t=>t.toLowerCase())),i=["width","height","left","right","top","bottom"],n=(t,e)=>{if(!e)return;let s="";return t.style.cssText&&(s+=t.style.cssText),"string"==typeof e?s+=e:Object.keys(e).forEach((t=>{i.indexOf(t)>=0&&!isNaN(e[t])?s+=`${t}:${e[t]}px;`:s+=`${t}:${e[t]};`})),t.style.cssText=s,t},o=(t,e)=>{let s=document.createElement(t);e=e||{};for(const t in e){let i=e[t];"style"===t?n(s,i):s.setAttribute(t,i)}return s},l=function(t,e){let s={style:t,class:"guide-step-target guide-overlayer-bgcolor"};const i=o("div",s);return i.innerHTML=a.call(this,e),i},a=function(t){return this.activeSteps[t],`\n\t<div class="guide-tooltip guide-tooltip-${t}" style="">\n\t    <div class="guide-joints">\n\t    </div>\n\t    <div class="guide-tooltip-main" style="width:${this.width}px;height:${this.height}px;">\n\t        <div class="guide-container"></div>\n\t        <div class="guide-button-box">\n\t            <div class="guide-button guide-next-button ${this.nextclass}" code="next" steps="${t}">${this.nextLabel}</div>\n\t            <div class="guide-button guide-prev-button ${this.prevclass}" code="prev" steps="${t}">${this.prevLabel}</div>\n\t            <div class="guide-button guide-skip-button ${this.skipclass}" code="skip" steps="${t}">${this.skipLabel}</div>\n\t            <div class="guide-button guide-done-button ${this.doneclass}" code="done" steps="${t}">${this.doneLabel}</div>\n\t        </div>\n\t    </div>\n\t</div>\n\t`};var r={content:"",width:"",height:"",offsetX:"0",offsetY:"0",position:"bottom",tipClass:"",jointsClass:"",jointsWidth:"",jointsHeight:"",jointsX:"",jointsY:""};class p{constructor(t){this.container=null,this.setOptions(r),this.setOptions(t)}setOption(t,e){t&&e&&(this[t]=e)}setOptions(t){t&&Object.keys(t).forEach((e=>{this.setOption(e,t[e])}))}setContainer(t){"hTMLDivElement"===s(t)&&(this.container=t.querySelector(".guide-container"),this.loadTip())}loadTip(){const t=document.querySelector(this.el);if(t&&t.getClientRects().length){const{width:e,height:s,top:i,left:n}=t.getClientRects()[0];this.elTarget={width:e,height:s,top:i,left:n}}this.container.innerHTML=function(t,e,s,i){i=i||function(t,e,s,i,n){var o=e.split("\n"),l=Math.max(i-3,0),a=Math.min(o.length,i+3),r=n(s),p=o.slice(l,a).map((function(t,e){var s=e+l+1;return(s==i?" >> ":"    ")+s+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(o,l)};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function l(t){return n[t]||t}var a=1;try{var r="";function s(t){null!=t&&(r+=t)}return s('<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    '),a=22,t.image&&(s('\n        <div class="guide-image guide-image-template1">\n            <img src="'),a=24,s(e(t.image)),s('" alt="" />\n        </div>\n        '),a=26),s('\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    '),a=30,s(e(t.title)),s("\n                </h3>\n                <p>\n                    "),a=33,s(e(t.text)),s("\n                </p>\n            </div>\n</div>"),a=36,r}catch(t){i(t,'<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    <% if (locals.image) { %>\n        <div class="guide-image guide-image-template1">\n            <img src="<%= locals.image %>" alt="" />\n        </div>\n        <% } %>\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    <%= locals.title %>\n                </h3>\n                <p>\n                    <%= locals.text %>\n                </p>\n            </div>\n</div>',void 0,a,e)}}(this.content)}setSize(t,e){if(Array.prototype.includes.call(t.classList,"guide-step-target")){const s=t.querySelector(".guide-tooltip-main"),i=this.width||e.width||parseInt(s.style.width),n=this.height||e.height||parseInt(s.style.height);console.log(i,n),s.style.width=`${i}px`,s.style.height=`${n}px`}}}return class{constructor(e){this.version="1.0.0",this.steps=null,this.activeSteps={},this.overlayer=null,this.setOptions(t),this.setOptions(e),this.bindEvent()}setOption(t,e){if(t)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}start(t){if(this.steps&&0!==this.steps?.length)return this._createOverlayer(),this.setStepsState(t,!0),this}setStepsState(t,e){const s=this.steps[t];if(e){if(this.activeSteps[t])return;this.activeSteps[t]={stepNumber:-1,steps:s},this._createGuideStepBox(t),this.body.appendChild(this.activeSteps[t].element),this._switchStepsNumber(t),this.setStepsNumber(t,0),this.overlayer.style.display="block"}else this._removeGuideStepBox(t),delete this.activeSteps[t]}_switchStepsNumber(t){var s,i;i=t=>{const e=Array.prototype.shift.call(t),{element:s,stepNumber:i,steps:n}=this.activeSteps[e],o=new p(n[i]);o.setContainer(s),this.activeSteps[e].currentStep=o,this._setTipPosition(e),o.setSize(s,{width:this.width,height:this.height})},e[s=t]||(e[s]=[]),e[s].push(i)}_setTipPosition(t){const e=this.activeSteps[t],{currentStep:s,element:i}=e;i.style.display="block";const n=s.elTarget;if(n){i.classList.remove("guide-step-notarget");const{width:t,height:e,top:s,left:o}=n;i.style.width=`${t}px`,i.style.height=`${e}px`,i.style.top=`${s}px`,i.style.left=`${o}px`}else i.classList.add("guide-step-notarget")}setStepsNumber(t,i){const n=this.activeSteps[t];if(!n)return;"number"===s(i)?n.stepNumber=i:"++"===i?n.stepNumber++:"--"===i&&n.stepNumber--;const o=n.steps.length;n.stepNumber>=0&&n.stepNumber<o?((...t)=>{let s=t[0];const i=e[s];if(!i||0===i.length)return!1;for(var n,o=0;n=i[o++];)n(t)})(t,n.stepNumber):this.remove(t)}remove(t){t?(this._removeGuideStepBox(t),this.setStepsState(t,!1)):console.error("缺少steps name.")}_createOverlayer(){this.overlayer||(this.overlayer=o("div",{style:{display:"none"},class:"guide-overlayer"}),this.body||(this.body=document.getElementsByTagName("body")[0]),this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove(),this.overlayer=null}_createGuideStepBox(t){if(!t)return void console.error("缺少 step name");const e=l.call(this,{display:"none"},t);this.activeSteps[t].element=e}_removeGuideStepBox(t){t?this.activeSteps[t]?.element?.remove():console.error("缺少 step name")}bindEvent(){this.body=document.getElementsByTagName("body")[0],this.body.onclick=t=>{const e=t.target;if(Array.prototype.includes.call(e.classList,"guide-button")){const t=e.getAttribute("code"),s=e.getAttribute("steps");switch(t){default:this.Next(s);break;case"prev":this.Prev(s);break;case"skip":this.Skip(s);break;case"done":this.Done(s)}}}}Next(t){t&&(this.activeSteps[t],this.setStepsNumber(t,"++"))}Prev(t){t&&this.setStepsNumber(t,"--")}Skip(t){t&&this.remove(t)}Done(t){t&&this.setStepsNumber(t,"++")}}}));
