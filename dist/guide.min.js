/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Tue, 07 Dec 2021 02:10:29 GMT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).guide=t()}(this,(function(){"use strict";var e={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",animation:!1,width:200,height:200};let t={};const s=e=>Object.prototype.toString.call(e).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(e=>e.toLowerCase())),i=["width","height","left","right","top","bottom"],n=(e,t)=>{if(!t)return;let s="";return e.style.cssText&&(s+=e.style.cssText),"string"==typeof t?s+=t:Object.keys(t).forEach((e=>{i.indexOf(e)>=0&&!isNaN(t[e])?s+=`${e}:${t[e]}px;`:s+=`${e}:${t[e]};`})),e.style.cssText=s,e},o=(e,t)=>{let s=document.createElement(e);t=t||{};for(const e in t){let i=t[e];"style"===e?n(s,i):s.setAttribute(e,i)}return s},l=function(e,t){let s={style:e,class:"guide-step-target guide-overlayer-bgcolor"};const i=o("div",s);return i.innerHTML=a.call(this,t),i},a=function(e){return console.log(e),`\n\t<div class="guide-tooltip guide-tooltip-${e}" style="">\n\t    <div class="guide-joints">\n\t    </div>\n\t    <div class="guide-tooltip-main">\n\t        <div class="guide-container"></div>\n\t        <div class="guide-button-box">\n\t            <div class="guide-button guide-next-button ${this.nextclass}" code="next" steps="${e}">${this.nextLabel}</div>\n\t            <div class="guide-button guide-prev-button ${this.prevclass}" code="prev" steps="${e}">${this.prevLabel}</div>\n\t            <div class="guide-button guide-skip-button ${this.skipclass}" code="skip" steps="${e}">${this.skipLabel}</div>\n\t            <div class="guide-button guide-done-button ${this.doneclass}" code="done" steps="${e}">${this.doneLabel}</div>\n\t        </div>\n\t    </div>\n\t</div>\n\t`};var r={content:"",width:"",height:"",followType:"follow",joints:"top",tipClass:""};class p{constructor(e){this.container=null,this.setOptions(r),this.setOptions(e)}setOption(e,t){e&&t&&(this[e]=t)}setOptions(e){e&&Object.keys(e).forEach((t=>{this.setOption(t,e[t])}))}setContainer(e){"hTMLDivElement"===s(e)&&(this.container=e.querySelector(".guide-container"),this.loadTip())}loadTip(){const e=document.querySelector(this.el);if(e){const{width:t,height:s,top:i,left:n}=e.getClientRects()[0];this.elTarget={width:t,height:s,top:i,left:n}}this.container.innerHTML=function(e,t,s,i){i=i||function(e,t,s,i,n){var o=t.split("\n"),l=Math.max(i-3,0),a=Math.min(o.length,i+3),r=n(s),p=o.slice(l,a).map((function(e,t){var s=t+l+1;return(s==i?" >> ":"    ")+s+"| "+e})).join("\n");throw e.path=r,e.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+e.message,e},t=t||function(e){return null==e?"":String(e).replace(o,l)};var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function l(e){return n[e]||e}var a=1;try{var r="";function s(e){null!=e&&(r+=e)}return s('<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    '),a=22,e.image&&(s('\n        <div class="guide-image guide-image-template1">\n            <img src="'),a=24,s(t(e.image)),s('" alt="" />\n        </div>\n        '),a=26),s('\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    '),a=30,s(t(e.title)),s("\n                </h3>\n                <p>\n                    "),a=33,s(t(e.text)),s("\n                </p>\n            </div>\n</div>"),a=36,r}catch(e){i(e,'<style>.guide-tip-template {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template .guide-message {\n    flex: 1; }\n    .guide-tip-template .guide-message h3 {\n      font-weight: 500;\n      font-size: 16px;\n      line-height: 24px;\n      letter-spacing: 1px;\n      color: #2f2e3f; }\n    .guide-tip-template .guide-message p {\n      font-size: 13px;\n      line-height: 22px;\n      letter-spacing: 1px;\n      color: rgba(47, 46, 63, 0.85); }\n</style>\n<div class="guide-tip-template">\n    <% if (locals.image) { %>\n        <div class="guide-image guide-image-template1">\n            <img src="<%= locals.image %>" alt="" />\n        </div>\n        <% } %>\n\n            <div class="guide-message guide-message-template1">\n                <h3>\n                    <%= locals.title %>\n                </h3>\n                <p>\n                    <%= locals.text %>\n                </p>\n            </div>\n</div>',void 0,a,t)}}(this.content)}}return class{constructor(t){this.version="1.0.0",this.steps=null,this.activeSteps={},this.overlayer=null,this.setOptions(e),this.setOptions(t),this.bindEvent()}setOption(e,t){if(e)return this[e]=t,this}setOptions(e){if(e)return Object.keys(e).forEach((t=>{this.setOption(t,e[t])})),this}start(e){if(this.steps&&0!==this.steps?.length)return this._createOverlayer(),this.setStepsState(e,!0),this}setStepsState(e,t){const s=this.steps[e];if(t){if(this.activeSteps[e])return;this.activeSteps[e]={stepNumber:-1,steps:s},this._createGuideStepBox(e),this.body.appendChild(this.activeSteps[e].element),this._switchStepsNumber(e),this.setStepsNumber(e,0)}else this._removeGuideStepBox(e),delete this.activeSteps[e]}_switchStepsNumber(e){var s,i;i=e=>{const t=Array.prototype.shift.call(e),{element:s,stepNumber:i,steps:n}=this.activeSteps[t],o=new p(n[i]);o.setContainer(s),this.activeSteps[t].currentStep=o,this._setTipPosition(t)},t[s=e]||(t[s]=[]),t[s].push(i)}_setTipPosition(e){const t=this.activeSteps[e],{currentStep:s,element:i}=t;i.style.display="block";const n=s.elTarget;if(n){const{width:e,height:t,top:s,left:o}=n;i.style.width=`${e}px`,i.style.height=`${t}px`,i.style.top=`${s}px`,i.style.left=`${o}px`}else i.classList.add("guide-step-notarget")}setStepsNumber(e,i){const n=this.activeSteps[e];if(!n)return;"number"===s(i)?n.stepNumber=i:"++"===i?n.stepNumber++:"--"===i&&n.stepNumber--;const o=n.steps.length;n.stepNumber>=0&&n.stepNumber<o?((...e)=>{let s=e[0];const i=t[s];if(!i||0===i.length)return!1;for(var n,o=0;n=i[o++];)n(e)})(e,n.stepNumber):this.remove(e)}remove(e){e?(this._removeGuideStepBox(e),this.setStepsState(e,!1)):console.error("缺少steps name.")}_createOverlayer(){this.overlayer||(this.overlayer=o("div",{style:{display:"none"},class:"guide-overlayer"}),this.body||(this.body=document.getElementsByTagName("body")[0]),this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove(),this.overlayer=null}_createGuideStepBox(e){if(!e)return void console.error("缺少 step name");const t=l.call(this,{display:"none"},e);this.activeSteps[e].element=t}_removeGuideStepBox(e){e?this.activeSteps[e]?.element?.remove():console.error("缺少 step name")}bindEvent(){this.body=document.getElementsByTagName("body")[0],this.body.onclick=e=>{const t=e.target;if(Array.prototype.includes.call(t.classList,"guide-button")){const e=t.getAttribute("code"),s=t.getAttribute("steps");switch(e){default:this.Next(s);break;case"prev":this.Prev(s);break;case"skip":this.Skip(s);break;case"done":this.Done(s)}}}}Next(e){e&&(this.activeSteps[e],this.setStepsNumber(e,"++"))}Prev(e){e&&this.setStepsNumber(e,"--")}Skip(e){e&&this.remove(e)}Done(e){e&&this.setStepsNumber(e,"++")}}}));
