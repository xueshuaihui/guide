/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Tue, 02 Nov 2021 04:01:13 GMT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).guide=t()}(this,(function(){"use strict";var e={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",autoPosition:!1,disableInteraction:!1,animation:!1,exitOnEsc:!1},t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",width:"",height:"",offsetTop:"20",offsetLeft:"0"};const s=(e,t)=>{if(!t)return;let s="";return e.style.cssText&&(s+=e.style.cssText),"string"==typeof t?s+=t:Object.keys(t).forEach((e=>{s+=`${e}:${t[e]};`})),e.style.cssText=s,e},i=(e,t)=>{let i=document.createElement(e);t=t||{};for(const e in t){let r=t[e];"style"===e?s(i,r):i.setAttribute(e,r)}return i},r=()=>{guide.nextstep()},o=()=>{guide.prevstep()},n=()=>{guide.skipstep()},l=()=>{guide.donestep()};let d=null,a=null,c=null,h=null;const p=()=>{d=d||document.querySelector(".guide-next-button"),a=a||document.querySelector(".guide-prev-button"),c=c||document.querySelector(".guide-skip-button"),h=h||document.querySelector(".guide-done-button")},u=e=>{[d,a,c,h].forEach((e=>{e&&e.classList.remove("hide","show")}));const t=e.steps,s=e.currentStepNumber,i=t.length;0===s?(d.classList.add("show"),a.classList.add("hide"),c.classList.add("hide"),h.classList.add("hide")):s===i-1?(d.classList.add("hide"),a.classList.add("show"),c.classList.add("hide"),h.classList.add("show")):(d.classList.add("show"),a.classList.add("show"),c.classList.add("hide"),h.classList.add("hide"))},v=(...e)=>{console.log(e)},g=e=>{const t=function(e){const t=history[e],s=new Event(e);return function(){const e=t.apply(this,arguments);return s.arguments=arguments,window.dispatchEvent(s),e}};history.pushState=t("pushState"),history.replaceState=t("replaceState"),window.addEventListener("hashchange",v),window.addEventListener("popstate",v),window.addEventListener("pushState",v),window.addEventListener("replaceState",v)};class y{constructor(e,s){this.el=null,this.target=null,this.content=null,this.guide=s,this.setOptions(t),this.setOptions(e)}setOption(e,t){e&&t&&(this[e]=t)}setOptions(e){e&&Object.keys(e).forEach((t=>{this.setOption(t,e[t])}))}create(){const e=this.el;var t;this.target=document.querySelector(e),this._createHelperLayer(),this._createToolTip(),(t=this)&&t.guide&&(t.guide,p(),d.addEventListener("click",r),a.addEventListener("click",o),c.addEventListener("click",n),h.addEventListener("click",l))}destory(){var e;(e=this)&&e.guide&&(e.guide,p(),d.removeEventListener("click",r),a.removeEventListener("click",o),c.removeEventListener("click",n),h.removeEventListener("click",l)),this._removeToolTip(),this._removeHelperLayer()}_getDomStyle(e){this.body=document.getElementsByTagName("body")[0];const t=this.guide.currentStep,{width:s,height:i,top:r,left:o}=t.target.getBoundingClientRect(),n=Number(t.offsetTop),l=Number(t.offsetLeft),d={width:s+"px",height:i+"px",top:r+"px",left:o+"px"},a={width:t.width+"px",height:t.height+"px",top:i+r+n+"px",left:o+l+"px"};switch(e){case"helperLayerStryle":return d;case"toolTipStyle":return a}}_createHelperLayer(){const e=this._getDomStyle("helperLayerStryle");this.guide.helperLayer?s(this.guide.helperLayer,e):(this.guide.helperLayer=i("div",{style:e,class:"guide-helperLayer"}),this.body.appendChild(this.guide.helperLayer))}_removeHelperLayer(){this.guide.helperLayer.remove()}_createToolTip(){const e=this._getDomStyle("toolTipStyle");this.guide.toolTip?s(this.guide.toolTip,e):(this.guide.toolTip=(e=>{const t=i("div",{style:e,class:"guide-tooltip"});return t.innerHTML='\n    <div class="guide-container">\n    <div class="guide-image">\n        <img src="" alt="" />\n    </div>\n    <div class="guide-message">\n        <h4>创建批注</h4>\n        <p>在设计图上 单击 或 拖拽 绘制 快捷键</p>\n    </div>\n</div>\n<div class="guide-button-box">\n    <div class="guide-button guide-next-button">继续探索</div>\n    <div class="guide-button guide-prev-button">上一步</div>\n    <div class="guide-button guide-skip-button">跳过</div>\n    <div class="guide-button guide-done-button">知道啦</div>\n</div>\n     ',t})(e),this.body.appendChild(this.guide.toolTip))}_removeToolTip(){this.guide.toolTip.remove()}}class m{constructor(t){this.allSteps={},this.steps=[],this.currentStep=null,this.currentStepNumber=-1,this.overlayer=null,this.toolTip=null,this.helperLayer=null,this.setOptions(e),this.setOptions(t)}get currentStep(){return this._currentStep}set currentStep(e){e&&this.currentStep!==e&&(this._currentStep=e,this.currentStep.create(),this._createOverlayer(),u(this))}setOption(e,t){if(e&&t)return this[e]=t,this}setOptions(e){if(e)return Object.keys(e).forEach((t=>{this.setOption(t,e[t])})),this}addstep(e){return this.steps.push(new y(e,this)),this}addsteps(e){var t;return"array"===(t=e,Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(e=>e.toLowerCase())))?e.forEach((e=>{this.addstep(e)})):console.error("stepDatas 格式错误"),this}addAllSteps(){return g(),this}goToStep(e){return this.currentStep!==e&&(this.currentStep=e,this.steps.indexOf(e)>-1&&this.goToStepNumber(this.steps.indexOf(e))),this}goToStepNumber(e){return this.currentStepNumber!==e&&(this.currentStepNumber=e,this.goToStep(this.steps[e])),this}nextstep(){const e=this.currentStepNumber;e<this.steps.length&&this.goToStepNumber(e+1)}prevstep(){const e=this.currentStepNumber;e>0&&this.goToStepNumber(e-1)}skipstep(){}donestep(){this.exit()}getcurrentstep(){}start(){var e;return this.goToStepNumber(0),e=this.currentStep,window.onresize=()=>{e.create()},this}exit(){this._removeOverlayer(),this.currentStep?.destory(),console.log("移除事件"),window.removeEventListener("hashchange",v),window.removeEventListener("popstate",v),window.removeEventListener("pushState",v),window.removeEventListener("replaceState",v)}_createOverlayer(){var e;this.overlayer||(this.overlayer=(e={opacity:this.overlayOpacity},i("div",{style:e,class:"guide-overlayer"})),this.body=document.getElementsByTagName("body")[0],this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove()}}return m.prototype.version="1.0.0",m}));
