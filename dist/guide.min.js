/*!
 * guide v1.0.0
 * author: xuesh
 * Date: Mon, 08 Nov 2021 10:11:35 GMT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).guide=e()}(this,(function(){"use strict";var t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",skipLabel:"跳过",skipclass:"",doneLabel:"完成",doneclass:"",confirmtipPosition:"bottom",confirmtipClass:"",overlayOpacity:".7",autoPosition:!1,disableInteraction:!1,animation:!1,exitOnEsc:!1,width:200,height:200},e={content:"",width:"",height:"",followType:"follow",joints:"top",tipClass:"animation"};const s=t=>Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(t=>t.toLowerCase())),i=["width","height","left","right","top","bottom"],n=(t,e)=>{if(!e)return;let s="";return t.style.cssText&&(s+=t.style.cssText),"string"==typeof e?s+=e:Object.keys(e).forEach((t=>{i.indexOf(t)>=0&&!isNaN(e[t])?s+=`${t}:${e[t]}px;`:s+=`${t}:${e[t]};`})),t.style.cssText=s,t},o=(t,e)=>{let s=document.createElement(t);e=e||{};for(const t in e){let i=e[t];"style"===t?n(s,i):s.setAttribute(t,i)}return s},r='\n<div class="guide-template">\n    <div class="guide-image guide-image-template1">\n        <img src="{{image}}" alt="" />\n    </div>\n    <div class="guide-message guide-message-template1">\n        <h3>{{title}}</h3>\n        <p>{{text}}</p>\n    </div>\n</div>\n',h=function(t){let e={style:t,class:"guide-helperLayer"};const s=o("div",e);return s.innerHTML=`\n    <div class="guide-tooltip ${this.joints} ${this.tipClass}" style="">\n        <div class="guide-joints">\n        </div>\n        <div class="guide-tooltip-main">\n            <div class="guide-container"></div>\n            <div class="guide-button-box">\n                <div class="guide-button guide-next-button ${this.guide.nextclass}">${this.guide.nextLabel}</div>\n                <div class="guide-button guide-prev-button ${this.guide.prevclass}">${this.guide.prevLabel}</div>\n                <div class="guide-button guide-skip-button ${this.guide.skipclass}">${this.guide.skipLabel}</div>\n                <div class="guide-button guide-done-button ${this.guide.doneclass}">${this.guide.doneLabel}</div>\n            </div>\n        </div>\n    </div>\n    `,s},l=function(){let t;this.guide.toolTip.classList.forEach((t=>{"guide-tooltip"!==t&&this.guide.toolTip.classList.remove(t)})),"full"!==this.followType&&this.guide.toolTip.classList.add(this.joints);const e=s(this.content);"string"===e?t=this.content:"object"===e&&(t=r.replace(/{{[\w\W][^{{][^}}]*}}/g,(t=>{const e=t.slice(2,-2);return this.content[e]||""})));this.guide.toolTip.querySelector(".guide-container").innerHTML=t};class d{constructor(t,s){this.el=null,this.target=null,this.guide=s,this.setOptions(e),this.setOptions(t)}setOption(t,e){t&&e&&(this[t]=e)}setOptions(t){t&&Object.keys(t).forEach((e=>{this.setOption(e,t[e])}))}create(){const t=this.el;if("body"!==t&&t){if(this.target=document.querySelector(t),!this.target)return void console.error(`未找到${this.el}元素`)}else this.target=document.querySelector("body"),this.followType="full";this._createHelperLayer()}destory(){this._removeHelperLayer()}_createHelperLayer(){this.body=document.getElementsByTagName("body")[0];let t=this.target.getBoundingClientRect();"full"===this.followType&&(t={width:0,height:0,top:"50%",left:"50%"});const{width:e,height:s,top:i,left:o}=t,r={width:e,height:s,top:i,left:o};this.guide.helperLayer?n(this.guide.helperLayer,r):(this.guide.helperLayer=h.apply(this,[r]),this.body.appendChild(this.guide.helperLayer),this.guide.toolTip=this.guide.helperLayer.querySelector(".guide-tooltip")),n(this.guide.toolTip.querySelector(".guide-tooltip-main"),{width:this.width,height:this.height}),l.apply(this)}_removeHelperLayer(){this.guide.helperLayer&&(this.guide.helperLayer.remove(),this.guide.helperLayer=null,this.guide.toolTip=null)}}const a=function(){this.nextstep()},u=function(){this.prevstep()},c=function(){this.skipstep()},p=function(){this.donestep()},g=function(){this.currentStep&&(v.apply(this),this.button.next?.addEventListener("click",a.bind(this)),this.button.prev?.addEventListener("click",u.bind(this)),this.button.skip?.addEventListener("click",c.bind(this)),this.button.done?.addEventListener("click",p.bind(this)))},v=function(){this.currentStep&&(this.button.next?.removeEventListener("click",a.bind(this),!0),this.button.prev?.removeEventListener("click",u.bind(this)),this.button.skip?.removeEventListener("click",c.bind(this)),this.button.done?.removeEventListener("click",p.bind(this)))},b=function(){this.currentStep?.create()},y=function(){window.addEventListener("resize",b.bind(this))},f=function(){window.removeEventListener("resize",b.bind(this))},m=function(){Object.values(this).forEach((t=>{t&&t.classList.remove("hide","show")}))},L=function(){if(!this.currentStep)return;m.apply(this.button);const t=this.steps,e=this.currentStepNumber,s=t.length,{next:i,prev:n,skip:o,done:r}=this.button;console.log(e,s,0<e<s-1),0===e&&e===s-1?(i?.classList.add("hide"),n?.classList.add("hide"),o?.classList.add("hide"),r?.classList.add("show")):0===e?(i?.classList.add("show"),n?.classList.add("hide"),o?.classList.add("hide"),r?.classList.add("hide")):e===s-1?(i?.classList.add("hide"),n?.classList.add("show"),o?.classList.add("hide"),r?.classList.add("show")):(i?.classList.add("show"),n?.classList.add("show"),o?.classList.add("hide"),r?.classList.add("hide"))},S=function(...t){const e=(t=>{let e;const{hash:s,pathname:i}=window.location;if(s){const t=s.indexOf("?");e=t>0?s.slice(1,t):s.slice(1)}else if(i){const t=s.indexOf("?");e=t>0?i.slice(0,t):i.slice(0)}else e="";return e})(),s=this.allSteps?this.allSteps[e]:null;setTimeout((()=>{this.setSteps(s).start()}),200)};var w={next:".guide-next-button",prev:".guide-prev-button",skip:".guide-skip-button",done:".guide-done-button"};class O{constructor(e){this.allSteps=null,this.steps=[],this.currentStep=null,this.currentStepNumber=-1,this.overlayer=null,this.toolTip=null,this.helperLayer=null,this.container=null,this.button=JSON.parse(JSON.stringify(w)),this.setOptions(t),this.setOptions(e)}get currentStep(){return this._currentStep}set currentStep(t){if(this.currentStep!==t){if(this._currentStep=t,!this._currentStep)return;this.currentStep?.create(),this._getButtonDom(),this._createOverlayer(),L.apply(this)}}setOption(t,e){if(t&&e)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}addstep(t){return this.steps||(this.steps=[]),this.steps.push(new d(t,this)),this}addsteps(t){return"array"===s(t)?t.forEach((t=>{this.addstep(t)})):console.error("stepDatas 格式错误"),this}setSteps(t){return this.steps=null,this.addsteps(t),this}addAllSteps(t){if("object"===s(t))return this.allSteps=t,this}goToStep(t){return this.currentStep!==t&&(this.currentStep=t,this.steps.indexOf(t)>-1&&this.goToStepNumber(this.steps.indexOf(t))),this}goToStepNumber(t){return this.currentStepNumber!==t&&(this.currentStepNumber=t,this.goToStep(this.steps[t])),this}nextstep(){const t=this.currentStepNumber;t<this.steps.length&&this.goToStepNumber(t+1)}prevstep(){const t=this.currentStepNumber;t>0&&this.goToStepNumber(t-1)}skipstep(){}donestep(){this.exit()}getcurrentstep(){}start(t){if(t){const e=this.allSteps[t];e&&this.setSteps(e)}if(console.log(this.steps),this.steps&&0!==this.steps?.length)return this.goToStepNumber(0),g.apply(this),y.apply(this),this}exit(){return v.apply(this),this._removeOverlayer(),function(){window.removeEventListener("hashchange",S.bind(this)),window.removeEventListener("popstate",S.bind(this)),window.removeEventListener("pushState",S.bind(this)),window.removeEventListener("replaceState",S.bind(this))}(),f.apply(this),this.currentStep?.destory(),this.goToStepNumber(-1),this._clearButtonDom(),this.steps=null,console.log(this),this}_createOverlayer(){var t;this.overlayer||(this.overlayer=(t={opacity:this.overlayOpacity},o("div",{style:t,class:"guide-overlayer"})),this.body=document.getElementsByTagName("body")[0],this.body.appendChild(this.overlayer))}_removeOverlayer(){this.overlayer?.remove(),this.overlayer=null}_getButtonDom(){Object.keys(this.button).forEach((t=>{"string"===s(this.button[t])&&(this.button[t]=document.querySelector(this.button[t]))}))}_clearButtonDom(){this.button=JSON.parse(JSON.stringify(w))}}return O.prototype.version="1.0.0",O}));
