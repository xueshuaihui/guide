/*!
 * guide v1.0.0beta0.0.1
 * author: xuesh
 * Date: Mon, 10 Jan 2022 16:54:22 GMT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).guide=e()}(this,(function(){"use strict";var t={nextLabel:"下一步",nextclass:"",prevLabel:"上一步",prevclass:"",prevEnable:!0,skipLabel:"跳过",skipclass:"",skipEnable:!1,doneLabel:"完成",doneclass:"",doneEnable:!0,confirmtipPosition:"bottom",confirmtipClass:"",openoverlayer:!1,overlayOpacity:".7",animation:!1,width:200,height:200,mount:null,unmount:null,jointsClass:"joints-triangle"};let e={};const n=t=>Object.prototype.toString.call(t).slice(1,-1).split(" ")[1].replace(/^[A-Z]/,(t=>t.toLowerCase())),i=["width","height","left","right","top","bottom","margin","margin-top","margin-left","margin-bottom","margin-right"],s=(t,e)=>{if(!e)return;let n="";return t.style.cssText&&(n+=t.style.cssText),"string"==typeof e?n+=e:Object.keys(e).forEach((t=>{i.indexOf(t)>=0&&!isNaN(e[t])?n+=`${t}:${e[t]}px;`:n+=`${t}:${e[t]};`})),t.style.cssText=n,t},o=(t,e)=>{let n=document.createElement(t);e=e||{};for(const t in e){let i=e[t];"style"===t?s(n,i):n.setAttribute(t,i)}return n},a=(t,e)=>{window.scrollBy(t,e)};const l=function(t,e){let n={style:t};n.class="guide-step-target "+(this.openoverlayer?"guide-overlayer-bgcolor":"");return o("div",n)},r=function(t){const e=o("div",{class:"guide-tooltip"});return e.innerHTML=function(t,e,n,i){i=i||function(t,e,n,i,s){var o=e.split("\n"),a=Math.max(i-3,0),l=Math.min(o.length,i+3),r=s(n),p=o.slice(a,l).map((function(t,e){var n=e+a+1;return(n==i?" >> ":"    ")+n+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(o,a)};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function a(t){return s[t]||t}var l=1;try{var r="";function n(t){null!=t&&(r+=t)}return n('<div class="guide-joints '),n(e(t.jointsClass)),n('">\n</div>\n<div class="guide-tooltip-main">\n    <div class="guide-container"></div>\n    <div class="guide-button-box">\n        <div class="guide-button guide-next-button '),l=6,n(e(t.nextclass)),n('" code="next" steps="'),n(e(t.name)),n('">\n            '),l=7,n(e(t.nextLabel)),n("\n        </div>\n\n        "),l=10,t.prevEnable&&(n('\n            <div class="guide-button guide-prev-button '),l=11,n(e(t.prevclass)),n('" code="prev" steps="'),n(e(t.name)),n('">\n                '),l=12,n(e(t.prevLabel)),n("\n            </div>\n            "),l=14),n("\n\n                "),l=16,t.skipEnable&&(n('\n                    <div class="guide-button guide-skip-button '),l=17,n(e(t.skipclass)),n('" code="skip"\n                        steps="'),l=18,n(e(t.name)),n('">\n                        '),l=19,n(e(t.skipLabel)),n("\n                    </div>\n                    "),l=21),n("\n                        "),l=22,t.doneEnable&&(n('\n                            <div class="guide-button guide-done-button '),l=23,n(e(t.doneclass)),n('" code="done"\n                                steps="'),l=24,n(e(t.name)),n('">\n                                '),l=25,n(e(t.doneLabel)),n("\n                            </div>\n                            "),l=27),n("\n\n    </div>\n</div>"),l=30,r}catch(t){i(t,'<div class="guide-joints <%= locals.jointsClass %>">\n</div>\n<div class="guide-tooltip-main">\n    <div class="guide-container"></div>\n    <div class="guide-button-box">\n        <div class="guide-button guide-next-button <%= locals.nextclass %>" code="next" steps="<%= locals.name %>">\n            <%= locals.nextLabel %>\n        </div>\n\n        <% if(locals.prevEnable){ %>\n            <div class="guide-button guide-prev-button <%= locals.prevclass %>" code="prev" steps="<%= locals.name %>">\n                <%= locals.prevLabel %>\n            </div>\n            <% } %>\n\n                <% if(locals.skipEnable){ %>\n                    <div class="guide-button guide-skip-button <%= locals.skipclass %>" code="skip"\n                        steps="<%= locals.name %>">\n                        <%= locals.skipLabel %>\n                    </div>\n                    <% } %>\n                        <% if(locals.doneEnable){ %>\n                            <div class="guide-button guide-done-button <%= locals.doneclass %>" code="done"\n                                steps="<%= locals.name %>">\n                                <%= locals.doneLabel %>\n                            </div>\n                            <%}%>\n\n    </div>\n</div>',void 0,l,e)}}({name:t,...this}),e};var p={content:"",width:"",height:"",offsetX:"0",offsetY:"0",position:"bottom",tipClass:"",jointsX:"",jointsY:"",mount:null,unmount:null,template:"template1"};var c={template1:function(t,e,n,i){i=i||function(t,e,n,i,s){var o=e.split("\n"),a=Math.max(i-3,0),l=Math.min(o.length,i+3),r=s(n),p=o.slice(a,l).map((function(t,e){var n=e+a+1;return(n==i?" >> ":"    ")+n+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(o,a)};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function a(t){return s[t]||t}var l=1;try{var r="";function n(t){null!=t&&(r+=t)}return n('<style>.guide-tip-template1 {\n  width: 100%;\n  height: 100%;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template1 .guide-message {\n    flex: 1; }\n    .guide-tip-template1 .guide-message h3 {\n      align-items: center;\n      letter-spacing: 1px;\n      font-family: PingFang SC;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 20px;\n      line-height: 28px;\n      color: #2878ff;\n      margin: 0; }\n    .guide-tip-template1 .guide-message p {\n      font-family: PingFang SC;\n      font-style: normal;\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: rgba(47, 46, 63, 0.65);\n      margin-top: 8px; }\n</style>\n<div class="guide-tip-template1">\n    '),l=28,Array.isArray(t)?(n("\n        "),l=29,t.forEach((function(t){n("\n            <div>\n                "),l=31,t.image&&(n('\n                    <div class="guide-image">\n                        <img src="'),l=33,n(e(t.image)),n('" alt="" />\n                    </div>\n                    '),l=35),n('\n                        <div class="guide-message">\n                            <h3>\n                                '),l=38,n(e(t.title)),n("\n                            </h3>\n                            <p>\n                                "),l=41,n(e(t.text)),n("\n                            </p>\n                        </div>\n            </div>\n            "),l=45})),n("\n                "),l=46):(n("\n                    <div>\n                        "),l=48,t.image&&(n('\n                            <div class="guide-image">\n                                <img src="'),l=50,n(e(item.image)),n('" alt="" />\n                            </div>\n                            '),l=52),n('\n                                <div class="guide-message">\n                                    <h3>\n                                        '),l=55,n(e(t.title)),n("\n                                    </h3>\n                                    <p>\n                                        "),l=58,n(e(t.text)),n("\n                                    </p>\n                                </div>\n                    </div>\n                    "),l=62),n("\n\n</div>"),l=64,r}catch(t){i(t,'<style>.guide-tip-template1 {\n  width: 100%;\n  height: 100%;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template1 .guide-message {\n    flex: 1; }\n    .guide-tip-template1 .guide-message h3 {\n      align-items: center;\n      letter-spacing: 1px;\n      font-family: PingFang SC;\n      font-style: normal;\n      font-weight: 600;\n      font-size: 20px;\n      line-height: 28px;\n      color: #2878ff;\n      margin: 0; }\n    .guide-tip-template1 .guide-message p {\n      font-family: PingFang SC;\n      font-style: normal;\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: rgba(47, 46, 63, 0.65);\n      margin-top: 8px; }\n</style>\n<div class="guide-tip-template1">\n    <% if(Array.isArray(locals)) { %>\n        <% locals.forEach(function(item){ %>\n            <div>\n                <% if (item.image) { %>\n                    <div class="guide-image">\n                        <img src="<%= item.image %>" alt="" />\n                    </div>\n                    <% } %>\n                        <div class="guide-message">\n                            <h3>\n                                <%= item.title %>\n                            </h3>\n                            <p>\n                                <%= item.text %>\n                            </p>\n                        </div>\n            </div>\n            <% }) %>\n                <% }else{ %>\n                    <div>\n                        <% if (locals.image) { %>\n                            <div class="guide-image">\n                                <img src="<%= item.image %>" alt="" />\n                            </div>\n                            <% } %>\n                                <div class="guide-message">\n                                    <h3>\n                                        <%= locals.title %>\n                                    </h3>\n                                    <p>\n                                        <%= locals.text %>\n                                    </p>\n                                </div>\n                    </div>\n                    <% } %>\n\n</div>',undefined,l,e)}},template2:function(t,e,n,i){i=i||function(t,e,n,i,s){var o=e.split("\n"),a=Math.max(i-3,0),l=Math.min(o.length,i+3),r=s(n),p=o.slice(a,l).map((function(t,e){var n=e+a+1;return(n==i?" >> ":"    ")+n+"| "+t})).join("\n");throw t.path=r,t.message=(r||"ejs")+":"+i+"\n"+p+"\n\n"+t.message,t},e=e||function(t){return null==t?"":String(t).replace(o,a)};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},o=/[&<>'"]/g;function a(t){return s[t]||t}var l=1;try{var r="";function n(t){null!=t&&(r+=t)}return n('<style>.guide-tip-template2 {\n  width: 100%;\n  height: 100%;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template2 .guide-image {\n    width: 100%;\n    height: auto; }\n    .guide-tip-template2 .guide-image img {\n      width: 100%; }\n  .guide-tip-template2 .guide-message {\n    flex: 1;\n    font-family: PingFang SC;\n    font-style: normal; }\n    .guide-tip-template2 .guide-message h3 {\n      align-items: center;\n      letter-spacing: 1px;\n      font-weight: 600;\n      font-size: 20px;\n      line-height: 28px;\n      color: #2878ff;\n      margin: 0; }\n    .guide-tip-template2 .guide-message p {\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: rgba(47, 46, 63, 0.65);\n      margin-top: 8px; }\n    .guide-tip-template2 .guide-message a {\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: #2878ff; }\n</style>\n<div class="guide-tip-template2">\n    <div>\n        '),l=37,t.image&&(n('\n            <div class="guide-image">\n                <img src="'),l=39,n(e(t.image)),n('" alt="" />\n            </div>\n            '),l=41),n('\n                <div class="guide-message">\n                    <h3>\n                        '),l=44,t.title&&(n("\n                            "),l=45),n("\n                                "),l=46,n(e(t.title)),n("\n                    </h3>\n                    <p>\n                        "),l=49,t.text&&(n("\n                            "),l=50),n("\n                                "),l=51,n(e(t.text)),n("\n                    </p>\n                    "),l=53,t.href&&(n('\n                        <a href="locals.href">locals.hrefText</a>\n                        '),l=55),n("\n\n                </div>\n    </div>\n\n</div>"),l=60,r}catch(t){i(t,'<style>.guide-tip-template2 {\n  width: 100%;\n  height: 100%;\n  font-family: PingFang SC;\n  color: rgba(47, 46, 63, 0.85); }\n  .guide-tip-template2 .guide-image {\n    width: 100%;\n    height: auto; }\n    .guide-tip-template2 .guide-image img {\n      width: 100%; }\n  .guide-tip-template2 .guide-message {\n    flex: 1;\n    font-family: PingFang SC;\n    font-style: normal; }\n    .guide-tip-template2 .guide-message h3 {\n      align-items: center;\n      letter-spacing: 1px;\n      font-weight: 600;\n      font-size: 20px;\n      line-height: 28px;\n      color: #2878ff;\n      margin: 0; }\n    .guide-tip-template2 .guide-message p {\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: rgba(47, 46, 63, 0.65);\n      margin-top: 8px; }\n    .guide-tip-template2 .guide-message a {\n      font-weight: normal;\n      font-size: 14px;\n      line-height: 22px;\n      color: #2878ff; }\n</style>\n<div class="guide-tip-template2">\n    <div>\n        <% if (locals.image) { %>\n            <div class="guide-image">\n                <img src="<%= locals.image %>" alt="" />\n            </div>\n            <% } %>\n                <div class="guide-message">\n                    <h3>\n                        <% if(locals.title){ %>\n                            <% } %>\n                                <%= locals.title %>\n                    </h3>\n                    <p>\n                        <% if(locals.text){ %>\n                            <% } %>\n                                <%= locals.text %>\n                    </p>\n                    <% if(locals.href){ %>\n                        <a href="locals.href">locals.hrefText</a>\n                        <% } %>\n\n                </div>\n    </div>\n\n</div>',undefined,l,e)}}};class g{constructor(t){this.container=null,this.setOptions(p),this.setOptions(t)}setOption(t,e){if(t)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}setTipContent(t){if(!t||"hTMLDivElement"!==n(t))return;t.querySelector(".guide-container").innerHTML=c[this.template||"template1"](this.content),s(t.querySelector(".guide-tooltip-main"),{width:this.width})}setTargetPosition(t){var e;const n=document.querySelector(this.el);if((t=>{const e=document.querySelector(t);if(!e||!e.getClientRects().length)return;const{width:n,height:i,top:s,left:o}=e.getClientRects()[0];(s<0||s>outerHeight-i)&&a(0,s-i)})(this.el),null===(e=document.querySelector(".guide-target"))||void 0===e||e.classList.remove("guide-target"),n&&n.getClientRects().length){n.classList.add("guide-target");const{width:e,height:i,top:o,left:a}=n.getClientRects()[0];s(t,{width:e+20,height:i+20,top:o-10,left:a-10,display:"block"})}else s(t,{width:0,height:0,top:0,left:0,display:"block"})}setTipPosition(t,e){if(e&&t){this.el&&document.querySelector(this.el)||(this.position="center");const{width:n,height:i,top:s,left:o}=e.getClientRects()[0],a={targetWidth:n,targetHeight:i,targetTop:s,targetLeft:o};switch(this.position){case"bottom":this._positionBottom(t,a);break;case"top":this._positionTop(t,a);break;case"left":this._positionLeft(t,a);break;case"right":this._positionRight(t,a);break;default:this._positionCenter(t)}t.className=`guide-tooltip guide-tooltip-${this.position}`}}_positionCenter(t){const{width:e,height:n}=t.getClientRects()[0];s(t,{top:window.screen.height/2-n/2,left:document.body.clientWidth/2-e/2})}_positionBottom(t,{targetWidth:e,targetHeight:n,targetTop:i,targetLeft:o}){const{width:a}=t.getClientRects()[0];s(t,{top:i+n,left:o+(e-a)/2})}_positionTop(t,{targetWidth:e,targetHeight:n,targetTop:i,targetLeft:o}){const{width:a,height:l}=t.getClientRects()[0];s(t,{top:i-l,left:o+(e-a)/2})}_positionLeft(t,{targetWidth:e,targetHeight:n,targetTop:i,targetLeft:o}){const{width:a,height:l}=t.getClientRects()[0];s(t,{top:i-(l-n)/2,left:o-a})}_positionRight(t,{targetWidth:e,targetHeight:n,targetTop:i,targetLeft:o}){const{height:a}=t.getClientRects()[0];s(t,{top:i-(a-n)/2,left:o+e})}positionOffset(t){if(!t||"hTMLDivElement"!==n(t))return;t.style.transform=`translate(${this.offsetX||0}px, ${this.offsetY||0}px)`;t.querySelector(".guide-joints").style.transform=`translate(${this.jointsX||0}px, ${this.jointsY||0}px)`}}return class{constructor(e){this.version="1.0.0beta0.0.1",this.steps=null,this.activeSteps={},this.overlayer=null,this.setOptions(t),this.setOptions(e),this.bindEvent()}setOption(t,e){if(t)return this[t]=e,this}setOptions(t){if(t)return Object.keys(t).forEach((e=>{this.setOption(e,t[e])})),this}start(t){var e;if(this.steps&&0!==(null===(e=this.steps)||void 0===e?void 0:e.length))return this._createOverlayer(),this.setStepsState(t,!0),this.activeSteps[t]}setStepsState(t,e){const i=this.steps[t];if(e){if(this.activeSteps[t])return;this.activeSteps[t]={stepNumber:-1,steps:i},this._createGuideTargetBox(t),this._createGuideTipBox(t),this.body.appendChild(this.activeSteps[t].targetElement),this.body.appendChild(this.activeSteps[t].tipElement),this._switchStepsNumber(t),this.setStepsNumber(t,0);const e=this.openoverlayer?"block":"none";s(this.overlayer,{display:e}),"function"===n(this.mount)&&this.mount(t,this.activeSteps[t])}else{var o;"function"===n(null===(o=this.activeSteps[t].currentStep)||void 0===o?void 0:o.unmount)&&this.activeSteps[t].currentStep.unmount(t,this.activeSteps[t].currentStep),"function"===n(this.unmount)&&this.unmount(t,this.activeSteps[t]),this.remove(t),delete this.activeSteps[t]}}_switchStepsNumber(t){var i,s;s=t=>{var e;const i=Array.prototype.shift.call(t);if(!this.activeSteps[i])return;const{stepNumber:s,steps:o}=this.activeSteps[i],a=new g(o[s]);this.setStep(a,this.activeSteps[i]),"function"===n(null===(e=this.activeSteps[i].currentStep)||void 0===e?void 0:e.unmount)&&this.activeSteps[i].currentStep.unmount(i,this.activeSteps[i].currentStep),this.activeSteps[i].currentStep=a,"function"===n(a.mount)&&a.mount(i,a),this.buttonState(this.activeSteps[i])},e[i=t]||(e[i]=[]),e[i].push(s)}setStep(t,e){const{tipElement:n,targetElement:i}=e;t.setTargetPosition(i),t.setTipContent(n),setTimeout((()=>{t.setTipPosition(n,i),t.positionOffset(n)}),0)}setStepsNumber(t,i){const s=this.activeSteps[t];if(!s)return;"number"===n(i)?s.stepNumber=i:"++"===i?s.stepNumber++:"--"===i&&s.stepNumber--;const o=s.steps.length;s.stepNumber>=0&&s.stepNumber<o?((...t)=>{let n=t[0];const i=e[n];if(!i||0===i.length)return!1;for(var s,o=0;s=i[o++];)s(t)})(t,s.stepNumber):this.setStepsState(t,!1)}remove(t){t?(this._removeGuideTargetBox(t),this._removeGuideTipBox(t),s(this.overlayer,{display:"none"})):console.error("缺少steps name.")}_createOverlayer(){this.overlayer||(this.overlayer=o("div",{style:{display:"none"},class:"guide-overlayer"}),this.body||(this.body=document.getElementsByTagName("body")[0]),this.body.appendChild(this.overlayer))}_removeOverlayer(){var t;null===(t=this.overlayer)||void 0===t||t.remove(),this.overlayer=null}_createGuideTargetBox(t){if(!t)return void console.error("缺少 step name");const e=l.call(this,{display:"none"},t);this.activeSteps[t].targetElement=e}_createGuideTipBox(t){if(!t)return void console.error("缺少 step name");const e=r.call(this,t);this.activeSteps[t].tipElement=e}_removeGuideTargetBox(t){var e,n;t?null===(e=this.activeSteps[t])||void 0===e||null===(n=e.targetElement)||void 0===n||n.remove():console.error("缺少 step name")}_removeGuideTipBox(t){var e,n;t?null===(e=this.activeSteps[t])||void 0===e||null===(n=e.tipElement)||void 0===n||n.remove():console.error("缺少 step name")}bindEvent(){this.body=document.getElementsByTagName("body")[0],this.body.onclick=t=>{const e=t.target;if(Array.prototype.includes.call(e.classList,"guide-button")){const t=e.getAttribute("code"),n=e.getAttribute("steps");switch(t){case"prev":this.Prev(n);break;case"skip":this.Skip(n);break;case"done":this.Done(n);break;default:this.Next(n)}}};const t=()=>{Object.values(this.activeSteps).forEach((t=>{if(t.currentStep){const{tipElement:e,targetElement:n}=t;t.currentStep.setTargetPosition(n),t.currentStep.setTipPosition(e,n)}}))};window.onresize=()=>{t()},window.onscroll=()=>{t()}}Next(t){t&&this.setStepsNumber(t,"++")}Prev(t){t&&this.setStepsNumber(t,"--")}Skip(t){t&&this.setStepsState(t,!1)}Done(t){t&&this.setStepsNumber(t,"++")}buttonState(t){const e=this.activeSteps;Object.values(e).forEach((e=>{const{tipElement:n}=e,i=n.querySelector(".guide-button.guide-next-button"),s=n.querySelector(".guide-button.guide-prev-button"),o=n.querySelector(".guide-button.guide-done-button"),{stepNumber:a,steps:l}=t,r=l.length;a>0?(null==s||s.classList.remove("hide"),null==s||s.classList.add("show")):(null==s||s.classList.remove("show"),null==s||s.classList.add("hide")),o&&a===r-1?(null==i||i.classList.remove("show"),null==i||i.classList.add("hide"),null==o||o.classList.remove("hide"),null==o||o.classList.add("show")):(null==o||o.classList.remove("show"),null==o||o.classList.add("hide"),null==i||i.classList.remove("hide"),null==i||i.classList.add("show"))}))}}}));
